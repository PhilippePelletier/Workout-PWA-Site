<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, viewport-fit=cover"/>
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-title" content="Workout">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="theme-color" content="#0ea5e9">
<link rel="manifest" href="manifest.webmanifest">
<link rel="icon" href="icons/icon-192.png">
<title>Workout â€” v2</title>
<style>
:root{ --bg:#070d1a; --text:#e6edf6; --muted:#98a2b3; --accent:#0ea5e9; --accent2:#22d3ee; --radius:18px; }
*{box-sizing:border-box}
html,body{height:100%}
body{ margin:0; color:var(--text); font-family: ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Arial;
      background:linear-gradient(180deg,#0b1430,#050a18 60%); -webkit-font-smoothing:antialiased; }
header{ position:sticky; top:0; z-index:50; backdrop-filter:blur(8px); background:rgba(7,13,26,.85); border-bottom:1px solid rgba(255,255,255,.08); padding-top:env(safe-area-inset-top); }
.wrap{ max-width:980px; margin:0 auto; padding:12px 16px; }
.row{ display:flex; gap:12px; align-items:center; flex-wrap:wrap; }
.tabs{ display:flex; gap:8px; flex:1 }
.tab{ padding:10px 14px; border-radius:12px; border:1px solid rgba(255,255,255,.12); color:var(--text); background:transparent }
.tab[aria-selected="true"]{ background:linear-gradient(135deg, rgba(14,165,233,.25), rgba(34,211,238,.12)); border-color:transparent }
main{ padding:20px 16px 24px }
.section{ display:none } .section.active{ display:block }
.card{ background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03)); border:1px solid rgba(255,255,255,.1); border-radius:var(--radius); padding:14px; }
.cards{ display:grid; grid-template-columns: repeat(auto-fit,minmax(260px,1fr)); gap:14px }
.muted{ color:var(--muted) }
.divider{ height:1px; background:linear-gradient(90deg,transparent, rgba(255,255,255,.18), transparent); margin:10px 0 }

/* Inputs: keep >=17px to avoid iOS zoom */
select,input,textarea{ font-size:17px; width:100%; background:rgba(255,255,255,.06); color:var(--text); border:1px solid rgba(255,255,255,.18); border-radius:10px; padding:12px 12px; outline:none; }
input[disabled]{ background:rgba(255,255,255,.04); color:var(--muted) }

/* Set row layout â€” give Weight most space */
.set-row{ display:grid; grid-template-columns: minmax(48px,.6fr) 1.6fr 1fr; gap:6px; align-items:center; margin:6px 0; }
.set-row .group{ display:flex; align-items:center; gap:6px }
.num-btn{ padding:6px 10px; border-radius:10px; border:1px solid rgba(255,255,255,.2); background:rgba(255,255,255,.06); }

/* On very small screens: shrink buttons, push more room to inputs */
@media (max-width:430px){
  .set-row{ grid-template-columns: minmax(44px,.55fr) 1.9fr 1.1fr; gap:4px; }
  .num-btn{ padding:4px 8px; }
}
@media (max-width:360px){
  /* Two-line layout: Weight gets whole second column, Reps drops below */
  .set-row{ grid-template-columns: minmax(44px,.5fr) 2.2fr; grid-auto-rows:auto; }
  .set-row > :nth-child(1){ grid-column:1 }
  .set-row > :nth-child(2){ grid-column:2 }
  .set-row > :nth-child(3){ grid-column:2 }
}

/* Timer button stays compact */
.timer-btn{ display:inline-flex; align-items:center; gap:8px; padding:6px 10px; border-radius:999px; background:rgba(34,197,94,.14); border:1px solid rgba(34,197,94,.4); }
.timer-btn small{ font-variant-numeric: tabular-nums }
.timer-hud{ position:fixed; right:14px; bottom:90px; background:rgba(14,165,233,.18); border:1px solid rgba(14,165,233,.4); padding:10px 12px; border-radius:16px; display:none }
.timer-hud.active{ display:block }

/* Toast (auto-save) */
.toast{ position:fixed; left:12px; bottom:24px; background:rgba(34,197,94,.14); border:1px solid rgba(34,197,94,.4); padding:6px 10px; border-radius:999px; display:none }
.toast.show{ display:inline-flex; gap:8px }
</style>
</head>
<body>
<header>
  <div class="wrap row">
    <strong>ğŸ‹ï¸ Workout</strong>
    <nav class="tabs" role="tablist">
      <button class="tab" role="tab" aria-selected="true" data-tab="plan">Program</button>
      <button class="tab" role="tab" aria-selected="false" data-tab="log" id="logTabBtn">Training Log</button>
    </nav>
  </div>
</header>

<main class="wrap">
  <section id="plan" class="section active">
    <div class="card">
      <h2 style="margin:6px 0 4px">5-Day Split</h2>
      <p class="muted">Each session â‰ˆ 50â€“60 min. Tap a day to view details.</p>
    </div>
    <div id="dayCards" class="cards"></div>
  </section>

  <section id="log" class="section">
    <div class="card">
      <h2 style="margin:6px 0 6px">Training Log</h2>
      <div class="divider"></div>
      <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-bottom:10px">
        <label>Week<select id="weekSel"></select></label>
        <label>Day<select id="daySel"></select></label>
      </div>
      <div id="logContainer"></div>
    </div>
  </section>
</main>

<div id="timerHud" class="timer-hud">
  <div>â±ï¸ Rest: <b id="hudLabel">â€”</b></div>
  <div style="display:flex; gap:8px; align-items:center; margin-top:6px">
    <span id="hudTime">00:00</span>
    <button id="hudStopBtn">Stop</button>
  </div>
</div>

<div id="saveToast" class="toast">ğŸ’¾ <span id="saveState">Saved</span></div>

<script>
function $(s){return document.querySelector(s)}; function $$(s){return Array.from(document.querySelectorAll(s))};
const STORAGE_KEY='workout_log_v2'; let saveTimer;

// minimal program (same as prior build)
var program={days:[
  {id:'U1',name:'Upper â€” Strength',exercises:[
    {name:'Barbell Bench Press',sets:4,reps:'5',rest:170},
    {name:'Weighted Pull-up',sets:4,reps:'5',rest:160},
    {name:'Overhead Press',sets:3,reps:'6',rest:140},
    {name:'Barbell Row',sets:3,reps:'6â€“8',rest:130},
    {name:'Incline DB Press',sets:2,reps:'8â€“10',rest:90},
    {name:'Face Pull',sets:2,reps:'12â€“15',rest:60}
  ]},
  {id:'L1',name:'Lower â€” Strength',exercises:[
    {name:'Back Squat',sets:4,reps:'5',rest:170},
    {name:'Romanian Deadlift',sets:3,reps:'6',rest:160},
    {name:'Bulgarian Split Squat',sets:3,reps:'8/side',rest:100},
    {name:'Lying Leg Curl',sets:2,reps:'10â€“12',rest:80},
    {name:'Standing Calf Raise',sets:3,reps:'10â€“12',rest:60}
  ]},
  {id:'P',name:'Push â€” Hypertrophy',exercises:[
    {name:'Incline DB Bench',sets:3,reps:'8â€“12',rest:90},
    {name:'Seated DB Shoulder Press',sets:3,reps:'8â€“12',rest:90},
    {name:'Cable Fly',sets:3,reps:'12â€“15',rest:60},
    {name:'DB Lateral Raise',sets:3,reps:'12â€“20',rest:45}
  ]},
  {id:'PL',name:'Pull â€” Hypertrophy',exercises:[
    {name:'Lat Pulldown',sets:3,reps:'8â€“12',rest:90},
    {name:'Chest-Supported Row',sets:3,reps:'8â€“12',rest:90},
    {name:'1-Arm DB Row',sets:3,reps:'10/side',rest:70}
  ]},
  {id:'L2',name:'Legs & Core â€” Hypertrophy',exercises:[
    {name:'Barbell Hip Thrust',sets:4,reps:'8â€“12',rest:90},
    {name:'Leg Press',sets:3,reps:'10â€“12',rest:90},
    {name:'Walking Lunge',sets:3,reps:'12/side',rest:70}
  ]}
]};

function humanRest(sec){ if(!sec) return 'â€”'; return sec>=120? Math.round(sec/60)+'m': sec+'s'; }
function formatMMSS(s){ s=Math.max(0,Math.ceil(s)); const m=Math.floor(s/60),sec=s%60; return (m<10?'0':'')+m+':'+(sec<10?'0':'')+sec; }

// Rest timers
let activeTimer=null; const hud=$("#timerHud"), hudTime=$("#hudTime"), hudLabel=$("#hudLabel");
function startTimer(seconds,label,btn){
  stopTimer(false);
  const end=Date.now()+seconds*1000;
  activeTimer={end,label,btn,interval:null};
  hud.style.display='block'; hudLabel.textContent=label;
  if(btn) btn.dataset.state='running';
  function tick(){
    if(!activeTimer) return;
    const remaining=Math.max(0,(activeTimer.end-Date.now())/1000);
    const txt=formatMMSS(remaining); hudTime.textContent=txt;
    const s=activeTimer.btn?.querySelector('small'); if(s) s.textContent=txt;
    if(remaining<=0.05) stopTimer(true);
  }
  tick(); activeTimer.interval=setInterval(tick,250);
}
function stopTimer(rang){
  if(!activeTimer) return;
  clearInterval(activeTimer.interval); hud.style.display='none';
  const btn=activeTimer.btn; if(btn){ btn.dataset.state='idle'; const s=btn.querySelector('small'); if(s){ const r=btn.dataset.rest; s.textContent=r?formatMMSS(Number(r)):'â€”'; } }
  activeTimer=null;
}
$("#hudStopBtn").addEventListener('click',()=>stopTimer(false));
document.addEventListener('click',e=>{
  const b=e.target.closest?.('.timer-btn'); if(!b) return;
  const secs=Number(b.dataset.rest||0); const holder=b.closest('[data-exlabel]'); const ex=holder?holder.getAttribute('data-exlabel'):'Exercise';
  if(b.dataset.state==='running') stopTimer(false); else if(secs>0) startTimer(secs,ex,b);
});
function timerButton(restSec){
  const secs=Number(restSec||0); const pretty=secs?formatMMSS(secs):'â€”';
  return `<button class="timer-btn" ${!secs?'disabled':''} data-rest="${secs}" data-state="idle">â±ï¸ <small>${pretty}</small></button>`;
}

// Storage
function storageGet(){ try{return JSON.parse(localStorage.getItem(STORAGE_KEY)||'{}')}catch(e){return {}} }
function storageSet(d){ localStorage.setItem(STORAGE_KEY, JSON.stringify(d)); const t=$("#saveToast"); $("#saveState").textContent='Savingâ€¦'; t.classList.add('show'); clearTimeout(saveTimer); saveTimer=setTimeout(()=>{ $("#saveState").textContent='Saved'; t.classList.remove('show'); },900); }
function ensure(obj, key, init){ if(!(key in obj)) obj[key]=init; return obj[key]; }

// Program list
function renderDayCards(){
  const el=$("#dayCards");
  el.innerHTML=program.days.map(d=>`
    <div class="card">
      <h3 style="margin:4px 0">ğŸ“… ${d.name}</h3>
      <div class="muted">Est. sets: <b>${d.exercises.reduce((a,x)=>a+(x.sets||0),0)}</b></div>
      <div class="divider"></div>
      <button onclick="openDay('${d.id}')">View workout</button>
    </div>`).join('');
}
function openDay(id){
  const d=program.days.find(x=>x.id===id); $("#logTabBtn").click(); $("#daySel").value=id; renderLog();
}

// Log
const weeks=[...Array(12)].map((_,i)=>i+1);
function populateSelectors(){
  $("#weekSel").innerHTML=weeks.map(w=>`<option value="${w}">Week ${w}</option>`).join('');
  $("#daySel").innerHTML=program.days.map(d=>`<option value="${d.id}">${d.name}</option>`).join('');
}
function currentKey(){ return $("#weekSel").value+'::'+$("#daySel").value; }
function renderLog(){
  const dayId=$("#daySel").value; const day=program.days.find(d=>d.id===dayId);
  const data=storageGet(); const key=currentKey();
  const log=ensure(data,'logs',{}); if(!(key in log)) log[key]={ex:[]};
  const entry=log[key];
  $("#logContainer").innerHTML = day.exercises.map((ex,idx)=>{
    const exLog=entry.ex[idx]||{sets:Array.from({length:ex.sets},()=>({w:'',r:''})),note:''};
    const sets=exLog.sets.length===ex.sets? exLog.sets: Array.from({length:ex.sets},(_,i)=>exLog.sets[i]||{w:'',r:''});
    return `
      <div class="card" data-exlabel="${ex.name}">
        <h4 style="margin:0 0 6px; display:flex; justify-content:space-between; align-items:center">${ex.name} ${timerButton(ex.rest)}</h4>
        <div class="set-row muted"><span>Set</span><span>Weight</span><span>Reps</span></div>
        ${sets.map((s,si)=>`
          <div class="set-row">
            <input value="${si+1}" disabled aria-label="Set ${si+1}"/>
            <div class="group">
              <button class="num-btn" data-delta="-2.5" data-target="w" data-ex="${idx}" data-si="${si}">â€“</button>
              <input inputmode="decimal" placeholder="kg/lb" data-ex="${idx}" data-si="${si}" data-field="w" value="${s.w||''}">
              <button class="num-btn" data-delta="2.5" data-target="w" data-ex="${idx}" data-si="${si}">+</button>
            </div>
            <div class="group">
              <button class="num-btn" data-delta="-1" data-target="r" data-ex="${idx}" data-si="${si}">â€“</button>
              <input inputmode="numeric" placeholder="reps" data-ex="${idx}" data-si="${si}" data-field="r" value="${s.r||''}">
              <button class="num-btn" data-delta="1" data-target="r" data-ex="${idx}" data-si="${si}">+</button>
            </div>
          </div>`).join('')}
      </div>`;
  }).join('');
  $("#logContainer").querySelectorAll('input[data-field],textarea').forEach(el=>el.addEventListener('input',()=>saveField(el)));
  $("#logContainer").querySelectorAll('.num-btn').forEach(btn=>btn.addEventListener('click',()=>{
    const exIdx=Number(btn.dataset.ex), si=Number(btn.dataset.si), target=btn.dataset.target;
    const input=$("#logContainer").querySelector(`input[data-ex="${exIdx}"][data-si="${si}"][data-field="${target}"]`);
    let val = target==='w'? parseFloat(input.value||'0'): parseInt(input.value||'0');
    if(!isFinite(val)) val=0;
    val += parseFloat(btn.dataset.delta);
    if(target==='r') val = Math.max(0, Math.round(val));
    input.value = String(val);
    saveField(input);
  }));
}
function saveField(el){
  const data=storageGet(); const key=currentKey();
  data.logs=data.logs||{}; if(!data.logs[key]) data.logs[key]={ex:[]};
  const dayId=$("#daySel").value; const day=program.days.find(d=>d.id===dayId);
  const exIdx=Number(el.dataset.ex), setIdx=Number(el.dataset.si), field=el.dataset.field;
  if(!data.logs[key].ex[exIdx]) data.logs[key].ex[exIdx]={sets:Array.from({length:day.exercises[exIdx].sets},()=>({w:'',r:''})),note:''};
  if(field){ data.logs[key].ex[exIdx].sets[setIdx][field]=el.value; } else { data.logs[key].ex[exIdx].note=el.value; }
  storageSet(data);
}

// Tabs
$$('.tab').forEach(b=>b.addEventListener('click',()=>{
  $$('.tab').forEach(x=>x.setAttribute('aria-selected', String(x===b)));
  $$('.section').forEach(s=>s.classList.remove('active'));
  $("#"+b.dataset.tab).classList.add('active');
  if(b.dataset.tab==='log') renderLog();
}));

// Init
populateSelectors(); renderDayCards(); renderLog();

// SW
if('serviceWorker' in navigator){ window.addEventListener('load', ()=>navigator.serviceWorker.register('service-worker.js')); }
</script>
</body>
</html>